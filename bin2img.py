from PIL import Image
import numpy as np
width = 1366
malwarelist=np.genfromtxt('trainLabels.csv',delimiter=",",dtype=str)
malwarelist=malwarelist[1:]
destination='F:\\images\\'
folder='F:\\train\\'
corrupted_files=[]
for name in malwarelist:
    b = ".bytes"
    nam=name[0].strip('"')
    loc = folder+nam + b
    hexar = []
    with open(loc, 'rb') as f:
        for line in f:
            hexar.extend(int(el, 16) for el in line.split()[1:] if el != b'??')
    print(len(hexar))
    if len(hexar)!=0:
        rn = len(hexar) // width
        fh = np.reshape(hexar[:rn * width], (-1, width))
        fh=  np.uint8(fh)
        print(nam,'  ',fh.shape)
        img = Image.fromarray(fh)
        img.save(destination+nam+".png")
    if len(hexar)==0:
        corrupted_files.append(nam)